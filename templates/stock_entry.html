<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Entry</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-[#edf2ec] flex justify-center items-center min-h-screen relative overflow-auto">
  <!-- Back Button -->
  <div class="absolute top-4 left-4">
    <a href="{{ url_for('dashboard') }}" class="bg-[#193a63] text-white px-4 py-2 rounded-full flex items-center shadow-md">
      ‚Üê Back to dashboard
    </a>
  </div>
  
  <!-- Time Display -->
  <div class="absolute top-4 right-4 bg-[#193a63] text-white px-4 py-1 rounded-lg shadow-md">
    12:43
  </div>
  
  
  <div class="bg-[#d3dfe4] shadow-xl rounded-xl p-6 w-full max-w-3xl mb-8 mt-24">
    <h2 class="text-xl font-bold mb-4">Stock Entry</h2>
    <form action="{{ url_for('stock_entry') }}" method="POST" class="space-y-4">
      <p class="text-gray-700 font-semibold mb-2">Enter Stock</p>
      
      <p class="text-gray-700 font-semibold mb-2">Entry Type:</p>
      <div class="flex space-x-4 mb-4">
        <label class="flex items-center space-x-2">
          <input type="radio" name="entry_type" value="add" class="form-radio" checked>
          <span>Add Stock</span>
        </label>
        <label class="flex items-center space-x-2">
          <input type="radio" name="entry_type" value="transfer" class="form-radio">
          <span>Transfer Stock</span>
        </label>
        <label class="flex items-center space-x-2">
          <input type="radio" name="entry_type" value="sold" class="form-radio">
          <span>Sold Stock</span>
        </label>
      </div>
      
      <label class="text-gray-700 font-semibold">Product</label>
      <select name="inventory_id" class="w-full p-2 mb-4 border rounded" required>
        {% for product in products %}
          <option value="{{ product[0] }}">{{ product[1] }}</option>
        {% endfor %}
      </select>
      
      <label class="text-gray-700 font-semibold">Quantity</label>
      <input type="number" name="quantity" class="w-full p-2 mb-4 border rounded" placeholder="Enter quantity" required>
      
      <!-- Add Stock Section -->
      <div id="add-stock-section">
        <label class="text-gray-700 font-semibold">Location</label>
        <select name="location_id" class="w-full p-2 mb-4 border rounded" required>
          {% for location in locations %}
            <option value="{{ location[0] }}">{{ location[1] }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Transfer Stock Section -->
      <div id="transfer-stock-section" class="hidden space-y-4">
        <label class="text-gray-700 font-semibold">From Location</label>
        <select name="from_location" class="w-full p-2 mb-4 border rounded">
          {% for location in locations %}
            <option value="{{ location[0] }}">{{ location[1] }}</option>
          {% endfor %}
        </select>
        <label class="text-gray-700 font-semibold">To Location</label>
        <select name="to_location" class="w-full p-2 mb-4 border rounded">
          {% for location in locations %}
            <option value="{{ location[0] }}">{{ location[1] }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Sold Stock Section -->
      <div id="sold-stock-section" class="hidden">
        <label class="text-gray-700 font-semibold">Location</label>
        <select name="location_id" class="w-full p-2 mb-4 border rounded" required>
          {% for location in locations %}
            <option value="{{ location[0] }}">{{ location[1] }}</option>
          {% endfor %}
        </select>
      </div>
      
      <button type="submit" class="w-full bg-[#193a63] text-white px-4 py-2 rounded-lg hover:bg-blue-800 shadow-md">
        Submit Stock Entry
      </button>
    </form>
    
    <!-- Recent Stock Movements -->
    <h3 class="text-lg font-bold mt-6">Recent Stock Movements</h3>
    <div class="overflow-x-auto mt-2">
      <table class="w-full border-collapse border border-gray-300">
        <thead>
          <tr class="bg-gray-300">
            <th class="border p-2">Movement ID</th>
            <th class="border p-2">Product</th>
            <th class="border p-2">From Location</th>
            <th class="border p-2">To Location</th>
            <th class="border p-2">Quantity</th>
            <th class="border p-2">Type</th>
            <th class="border p-2">Timestamp</th>
            <th class="border p-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for move in movements %}
          <tr>
            <td class="border p-2">{{ move.movement_id }}</td>
            <td class="border p-2">{{ move.product_name }}</td>
            <td class="border p-2">{{ move.from_location }}</td>
            <td class="border p-2">{{ move.to_location }}</td>
            <td class="border p-2">{{ move.quantity }}</td>
            <td class="border p-2">{{ move.movement_type }}</td>
            <td class="border p-2">{{ move.created_at }}</td>
            <td class="border p-2">
              <form action="{{ url_for('undo_movement') }}" method="POST" onsubmit="return confirm('Are you sure you want to undo this movement?');">
                <input type="hidden" name="movement_id" value="{{ move.movement_id }}">
                <button type="submit" class="px-2 py-1 bg-yellow-500 text-white rounded">Undo</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td class="border p-2 text-center" colspan="8">No recent stock movements found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  
  <script>
    // Toggle form sections based on entry type selection
    $('input[name="entry_type"]').on('change', function() {
      var value = $(this).val();
      if (value === 'add') {
        $('#add-stock-section').removeClass('hidden');
        $('#transfer-stock-section').addClass('hidden');
        $('#sold-stock-section').addClass('hidden');
      } else if (value === 'transfer') {
        $('#transfer-stock-section').removeClass('hidden');
        $('#add-stock-section').addClass('hidden');
        $('#sold-stock-section').addClass('hidden');
      } else if (value === 'sold') {
        $('#sold-stock-section').removeClass('hidden');
        $('#add-stock-section').addClass('hidden');
        $('#transfer-stock-section').addClass('hidden');
      }
    });
  </script>
</body>
</html>
